"use client";import{useFocusRing as Ie}from"@react-aria/focus";import{useHover as Pe}from"@react-aria/interactions";import{useVirtualizer as Ge}from"@tanstack/react-virtual";import D,{Fragment as Ae,createContext as ce,createRef as ze,useCallback as fe,useContext as Te,useMemo as $,useReducer as Ke,useRef as te,useState as Re}from"react";import{flushSync as oe}from"react-dom";import{useActivePress as je}from'../../hooks/use-active-press.js';import{useByComparator as We}from'../../hooks/use-by-comparator.js';import{useControllable as $e}from'../../hooks/use-controllable.js';import{useDefaultValue as Xe}from'../../hooks/use-default-value.js';import{useDisposables as _e}from'../../hooks/use-disposables.js';import{useElementSize as he}from'../../hooks/use-element-size.js';import{useEvent as m}from'../../hooks/use-event.js';import{useId as de}from'../../hooks/use-id.js';import{useInertOthers as Je}from'../../hooks/use-inert-others.js';import{useIsoMorphicEffect as Y}from'../../hooks/use-iso-morphic-effect.js';import{useLatestValue as qe}from'../../hooks/use-latest-value.js';import{useOnDisappear as Ye}from'../../hooks/use-on-disappear.js';import{useOutsideClick as Qe}from'../../hooks/use-outside-click.js';import{useOwnerDocument as xe}from'../../hooks/use-owner.js';import{useRefocusableInput as Me}from'../../hooks/use-refocusable-input.js';import{useResolveButtonType as Ze}from'../../hooks/use-resolve-button-type.js';import{useScrollLock as et}from'../../hooks/use-scroll-lock.js';import{useSyncRefs as be}from'../../hooks/use-sync-refs.js';import{useTrackedPointer as tt}from'../../hooks/use-tracked-pointer.js';import{transitionDataAttributes as ot,useTransition as nt}from'../../hooks/use-transition.js';import{useTreeWalker as it}from'../../hooks/use-tree-walker.js';import{useWatch as De}from'../../hooks/use-watch.js';import{useDisabled as rt}from'../../internal/disabled.js';import{FloatingProvider as lt,useFloatingPanel as at,useFloatingPanelProps as ut,useFloatingReference as pt,useResolvedAnchor as st}from'../../internal/floating.js';import{FormFields as dt}from'../../internal/form-fields.js';import{Frozen as bt,useFrozenData as Fe}from'../../internal/frozen.js';import{useProvidedId as mt}from'../../internal/id.js';import{OpenClosedProvider as ct,State as me,useOpenClosed as ft}from'../../internal/open-closed.js';import{history as Ve}from'../../utils/active-element-history.js';import{isDisabledReactIssue7711 as Tt}from'../../utils/bugs.js';import{Focus as P,calculateActiveIndex as Le}from'../../utils/calculate-active-index.js';import{disposables as we}from'../../utils/disposables.js';import{sortByDomNode as xt}from'../../utils/focus-management.js';import{match as ne}from'../../utils/match.js';import{isMobile as gt}from'../../utils/platform.js';import{RenderFeatures as Be,forwardRefWithAs as re,mergeProps as ge,useRender as le}from'../../utils/render.js';import{useDescribedBy as vt}from'../description/description.js';import{Keys as L}from'../keyboard.js';import{Label as yt,useLabelledBy as ve,useLabels as Ot}from'../label/label.js';import{MouseButton as Ne}from'../mouse.js';import{Portal as Ct}from'../portal/portal.js';var Et=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Et||{}),St=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(St||{}),It=(o=>(o[o.Pointer=0]="Pointer",o[o.Focus=1]="Focus",o[o.Other=2]="Other",o))(It||{}),Pt=(r=>(r[r.OpenCombobox=0]="OpenCombobox",r[r.CloseCombobox=1]="CloseCombobox",r[r.GoToOption=2]="GoToOption",r[r.SetTyping=3]="SetTyping",r[r.RegisterOption=4]="RegisterOption",r[r.UnregisterOption=5]="UnregisterOption",r[r.SetActivationTrigger=6]="SetActivationTrigger",r[r.UpdateVirtualConfiguration=7]="UpdateVirtualConfiguration",r[r.SetInputElement=8]="SetInputElement",r[r.SetButtonElement=9]="SetButtonElement",r[r.SetOptionsElement=10]="SetOptionsElement",r))(Pt||{});function ye(t,i=e=>e){let e=t.activeOptionIndex!==null?t.options[t.activeOptionIndex]:null,o=i(t.options.slice()),c=o.length>0&&o[0].dataRef.current.order!==null?o.sort((b,d)=>b.dataRef.current.order-d.dataRef.current.order):xt(o,b=>b.dataRef.current.domRef.current),f=e?c.indexOf(e):null;return f===-1&&(f=null),{options:c,activeOptionIndex:f}}let At={[1](t){var i;return(i=t.dataRef.current)!=null&&i.disabled||t.comboboxState===1?t:{...t,activeOptionIndex:null,comboboxState:1,isTyping:!1,activationTrigger:2,__demoMode:!1}},[0](t){var i,e;if((i=t.dataRef.current)!=null&&i.disabled||t.comboboxState===0)return t;if((e=t.dataRef.current)!=null&&e.value){let o=t.dataRef.current.calculateIndex(t.dataRef.current.value);if(o!==-1)return{...t,activeOptionIndex:o,comboboxState:0,__demoMode:!1}}return{...t,comboboxState:0,__demoMode:!1}},[3](t,i){return t.isTyping===i.isTyping?t:{...t,isTyping:i.isTyping}},[2](t,i){var f,b,d,T;if((f=t.dataRef.current)!=null&&f.disabled||t.optionsElement&&!((b=t.dataRef.current)!=null&&b.optionsPropsRef.current.static)&&t.comboboxState===1)return t;if(t.virtual){let{options:s,disabled:n}=t.virtual,r=i.focus===P.Specific?i.idx:Le(i,{resolveItems:()=>s,resolveActiveIndex:()=>{var S,F;return(F=(S=t.activeOptionIndex)!=null?S:s.findIndex(a=>!n(a)))!=null?F:null},resolveDisabled:n,resolveId(){throw new Error("Function not implemented.")}}),E=(d=i.trigger)!=null?d:2;return t.activeOptionIndex===r&&t.activationTrigger===E?t:{...t,activeOptionIndex:r,activationTrigger:E,isTyping:!1,__demoMode:!1}}let e=ye(t);if(e.activeOptionIndex===null){let s=e.options.findIndex(n=>!n.dataRef.current.disabled);s!==-1&&(e.activeOptionIndex=s)}let o=i.focus===P.Specific?i.idx:Le(i,{resolveItems:()=>e.options,resolveActiveIndex:()=>e.activeOptionIndex,resolveId:s=>s.id,resolveDisabled:s=>s.dataRef.current.disabled}),c=(T=i.trigger)!=null?T:2;return t.activeOptionIndex===o&&t.activationTrigger===c?t:{...t,...e,isTyping:!1,activeOptionIndex:o,activationTrigger:c,__demoMode:!1}},[4]:(t,i)=>{var f,b,d;if((f=t.dataRef.current)!=null&&f.virtual)return{...t,options:[...t.options,i.payload]};let e=i.payload,o=ye(t,T=>(T.push(e),T));t.activeOptionIndex===null&&(b=t.dataRef.current)!=null&&b.isSelected(i.payload.dataRef.current.value)&&(o.activeOptionIndex=o.options.indexOf(e));let c={...t,...o,activationTrigger:2};return(d=t.dataRef.current)!=null&&d.__demoMode&&t.dataRef.current.value===void 0&&(c.activeOptionIndex=0),c},[5]:(t,i)=>{var o;if((o=t.dataRef.current)!=null&&o.virtual)return{...t,options:t.options.filter(c=>c.id!==i.id)};let e=ye(t,c=>{let f=c.findIndex(b=>b.id===i.id);return f!==-1&&c.splice(f,1),c});return{...t,...e,activationTrigger:2}},[6]:(t,i)=>t.activationTrigger===i.trigger?t:{...t,activationTrigger:i.trigger},[7]:(t,i)=>{var o,c;if(t.virtual===null)return{...t,virtual:{options:i.options,disabled:(o=i.disabled)!=null?o:()=>!1}};if(t.virtual.options===i.options&&t.virtual.disabled===i.disabled)return t;let e=t.activeOptionIndex;if(t.activeOptionIndex!==null){let f=i.options.indexOf(t.virtual.options[t.activeOptionIndex]);f!==-1?e=f:e=null}return{...t,activeOptionIndex:e,virtual:{options:i.options,disabled:(c=i.disabled)!=null?c:()=>!1}}},[8]:(t,i)=>t.inputElement===i.element?t:{...t,inputElement:i.element},[9]:(t,i)=>t.buttonElement===i.element?t:{...t,buttonElement:i.element},[10]:(t,i)=>t.optionsElement===i.element?t:{...t,optionsElement:i.element}},Oe=ce(null);Oe.displayName="ComboboxActionsContext";function ae(t){let i=Te(Oe);if(i===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,ae),e}return i}let ke=ce(null);function Rt(t){let i=ie("VirtualProvider"),e=_e(),{options:o}=i.virtual,[c,f]=$(()=>{let n=i.optionsElement;if(!n)return[0,0];let r=window.getComputedStyle(n);return[parseFloat(r.paddingBlockStart||r.paddingTop),parseFloat(r.paddingBlockEnd||r.paddingBottom)]},[i.optionsElement]),b=Ge({enabled:o.length!==0,scrollPaddingStart:c,scrollPaddingEnd:f,count:o.length,estimateSize(){return 40},getScrollElement(){return i.optionsElement},overscan:12}),[d,T]=Re(0);Y(()=>{T(n=>n+1)},[o]);let s=b.getVirtualItems();return s.length===0?null:D.createElement(ke.Provider,{value:b},D.createElement("div",{style:{position:"relative",width:"100%",height:`${b.getTotalSize()}px`},ref:n=>{if(!n){e.dispose();return}i.activationTrigger!==0&&e.nextFrame(()=>{i.activeOptionIndex!==null&&o.length>i.activeOptionIndex&&b.scrollToIndex(i.activeOptionIndex)})}},s.map(n=>{var r;return D.createElement(Ae,{key:n.key},D.cloneElement((r=t.children)==null?void 0:r.call(t,{...t.slot,option:o[n.index]}),{key:`${d}-${n.key}`,"data-index":n.index,"aria-setsize":o.length,"aria-posinset":n.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${n.start}px)`,overflowAnchor:"none"}}))})))}let ue=ce(null);ue.displayName="ComboboxDataContext";function ie(t){let i=Te(ue);if(i===null){let e=new Error(`<${t} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(e,ie),e}return i}function _t(t,i){return ne(i.type,At,t,i)}let ht=Ae;function Mt(t,i){var Ce,Ee;let e=rt(),{value:o,defaultValue:c,onChange:f,form:b,name:d,by:T,invalid:s=!1,disabled:n=e||!1,onClose:r,__demoMode:E=!1,multiple:S=!1,immediate:F=!1,virtual:a=null,nullable:U,...N}=t,_=Xe(c),[I=S?[]:void 0,A]=$e(o,f,_),[O,x]=Ke(_t,{dataRef:ze(),comboboxState:E?0:1,isTyping:!1,options:[],virtual:a?{options:a.options,disabled:(Ce=a.disabled)!=null?Ce:()=>!1}:null,activeOptionIndex:null,activationTrigger:2,inputElement:null,buttonElement:null,optionsElement:null,__demoMode:E}),M=te(!1),y=te({static:!1,hold:!1}),B=We(T),X=m(u=>a?T===null?a.options.indexOf(u):a.options.findIndex(v=>B(v,u)):O.options.findIndex(v=>B(v.dataRef.current.value,u))),J=fe(u=>ne(p.mode,{[1]:()=>I.some(v=>B(v,u)),[0]:()=>B(I,u)}),[I]),k=m(u=>O.activeOptionIndex===X(u)),p=$(()=>({...O,immediate:F,optionsPropsRef:y,value:I,defaultValue:_,disabled:n,invalid:s,mode:S?1:0,virtual:a?O.virtual:null,get activeOptionIndex(){if(M.current&&O.activeOptionIndex===null&&(a?a.options.length>0:O.options.length>0)){if(a){let v=a.options.findIndex(K=>{var se,Se;return!((Se=(se=a.disabled)==null?void 0:se.call(a,K))!=null&&Se)});if(v!==-1)return v}let u=O.options.findIndex(v=>!v.dataRef.current.disabled);if(u!==-1)return u}return O.activeOptionIndex},calculateIndex:X,compare:B,isSelected:J,isActive:k}),[I,_,n,s,S,E,O,a]);Y(()=>{var u;a&&x({type:7,options:a.options,disabled:(u=a.disabled)!=null?u:null})},[a,a==null?void 0:a.options,a==null?void 0:a.disabled]),Y(()=>{O.dataRef.current=p},[p]);let j=p.comboboxState===0;Qe(j,[p.buttonElement,p.inputElement,p.optionsElement],()=>V.closeCombobox());let G=$(()=>{var u,v,K;return{open:p.comboboxState===0,disabled:n,invalid:s,activeIndex:p.activeOptionIndex,activeOption:p.activeOptionIndex===null?null:p.virtual?p.virtual.options[(u=p.activeOptionIndex)!=null?u:0]:(K=(v=p.options[p.activeOptionIndex])==null?void 0:v.dataRef.current.value)!=null?K:null,value:I}},[p,n,I,s]),g=m(()=>{if(p.activeOptionIndex!==null){if(V.setIsTyping(!1),p.virtual)W(p.virtual.options[p.activeOptionIndex]);else{let{dataRef:u}=p.options[p.activeOptionIndex];W(u.current.value)}V.goToOption(P.Specific,p.activeOptionIndex)}}),z=m(()=>{x({type:0}),M.current=!0}),pe=m(()=>{x({type:1}),M.current=!1,r==null||r()}),ee=m(u=>{x({type:3,isTyping:u})}),Q=m((u,v,K)=>(M.current=!1,u===P.Specific?x({type:2,focus:P.Specific,idx:v,trigger:K}):x({type:2,focus:u,trigger:K}))),Z=m((u,v)=>(x({type:4,payload:{id:u,dataRef:v}}),()=>{p.isActive(v.current.value)&&(M.current=!0),x({type:5,id:u})})),W=m(u=>ne(p.mode,{[0](){return A==null?void 0:A(u)},[1](){let v=p.value.slice(),K=v.findIndex(se=>B(se,u));return K===-1?v.push(u):v.splice(K,1),A==null?void 0:A(v)}})),h=m(u=>{x({type:6,trigger:u})}),l=m(u=>{x({type:8,element:u})}),H=m(u=>{x({type:9,element:u})}),R=m(u=>{x({type:10,element:u})}),V=$(()=>({onChange:W,registerOption:Z,goToOption:Q,setIsTyping:ee,closeCombobox:pe,openCombobox:z,setActivationTrigger:h,selectActiveOption:g,setInputElement:l,setButtonElement:H,setOptionsElement:R}),[]),[C,w]=Ot(),q=i===null?{}:{ref:i},He=fe(()=>{if(_!==void 0)return A==null?void 0:A(_)},[A,_]),Ue=le();return D.createElement(w,{value:C,props:{htmlFor:(Ee=p.inputElement)==null?void 0:Ee.id},slot:{open:p.comboboxState===0,disabled:n}},D.createElement(lt,null,D.createElement(Oe.Provider,{value:V},D.createElement(ue.Provider,{value:p},D.createElement(ct,{value:ne(p.comboboxState,{[0]:me.Open,[1]:me.Closed})},d!=null&&D.createElement(dt,{disabled:n,data:I!=null?{[d]:I}:{},form:b,onReset:He}),Ue({ourProps:q,theirProps:N,slot:G,defaultTag:ht,name:"Combobox"}))))))}let Dt="input";function Ft(t,i){var ee,Q,Z,W,h;let e=ie("Combobox.Input"),o=ae("Combobox.Input"),c=de(),f=mt(),{id:b=f||`headlessui-combobox-input-${c}`,onChange:d,displayValue:T,disabled:s=e.disabled||!1,autoFocus:n=!1,type:r="text",...E}=t,S=te(null),F=be(S,i,pt(),o.setInputElement),a=xe(e.inputElement),U=_e(),N=m(()=>{o.onChange(null),e.optionsElement&&(e.optionsElement.scrollTop=0),o.goToOption(P.Nothing)}),_=$(()=>{var l;return typeof T=="function"&&e.value!==void 0?(l=T(e.value))!=null?l:"":typeof e.value=="string"?e.value:""},[e.value,T]);De(([l,H],[R,V])=>{if(e.isTyping)return;let C=S.current;C&&((V===0&&H===1||l!==R)&&(C.value=l),requestAnimationFrame(()=>{if(e.isTyping||!C||(a==null?void 0:a.activeElement)!==C)return;let{selectionStart:w,selectionEnd:q}=C;Math.abs((q!=null?q:0)-(w!=null?w:0))===0&&w===0&&C.setSelectionRange(C.value.length,C.value.length)}))},[_,e.comboboxState,a,e.isTyping]),De(([l],[H])=>{if(l===0&&H===1){if(e.isTyping)return;let R=S.current;if(!R)return;let V=R.value,{selectionStart:C,selectionEnd:w,selectionDirection:q}=R;R.value="",R.value=V,q!==null?R.setSelectionRange(C,w,q):R.setSelectionRange(C,w)}},[e.comboboxState]);let I=te(!1),A=m(()=>{I.current=!0}),O=m(()=>{U.nextFrame(()=>{I.current=!1})}),x=m(l=>{switch(o.setIsTyping(!0),l.key){case L.Enter:if(e.comboboxState!==0||I.current)return;if(l.preventDefault(),l.stopPropagation(),e.activeOptionIndex===null){o.closeCombobox();return}o.selectActiveOption(),e.mode===0&&o.closeCombobox();break;case L.ArrowDown:return l.preventDefault(),l.stopPropagation(),ne(e.comboboxState,{[0]:()=>o.goToOption(P.Next),[1]:()=>o.openCombobox()});case L.ArrowUp:return l.preventDefault(),l.stopPropagation(),ne(e.comboboxState,{[0]:()=>o.goToOption(P.Previous),[1]:()=>{oe(()=>o.openCombobox()),e.value||o.goToOption(P.Last)}});case L.Home:if(l.shiftKey)break;return l.preventDefault(),l.stopPropagation(),o.goToOption(P.First);case L.PageUp:return l.preventDefault(),l.stopPropagation(),o.goToOption(P.First);case L.End:if(l.shiftKey)break;return l.preventDefault(),l.stopPropagation(),o.goToOption(P.Last);case L.PageDown:return l.preventDefault(),l.stopPropagation(),o.goToOption(P.Last);case L.Escape:return e.comboboxState!==0?void 0:(l.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&l.stopPropagation(),e.mode===0&&e.value===null&&N(),o.closeCombobox());case L.Tab:if(e.comboboxState!==0)return;e.mode===0&&e.activationTrigger!==1&&o.selectActiveOption(),o.closeCombobox();break}}),M=m(l=>{d==null||d(l),e.mode===0&&l.target.value===""&&N(),o.openCombobox()}),y=m(l=>{var R,V,C;let H=(R=l.relatedTarget)!=null?R:Ve.find(w=>w!==l.currentTarget);if(!((V=e.optionsElement)!=null&&V.contains(H))&&!((C=e.buttonElement)!=null&&C.contains(H))&&e.comboboxState===0)return l.preventDefault(),e.mode===0&&e.value===null&&N(),o.closeCombobox()}),B=m(l=>{var R,V,C;let H=(R=l.relatedTarget)!=null?R:Ve.find(w=>w!==l.currentTarget);(V=e.buttonElement)!=null&&V.contains(H)||(C=e.optionsElement)!=null&&C.contains(H)||e.disabled||e.immediate&&e.comboboxState!==0&&U.microTask(()=>{oe(()=>o.openCombobox()),o.setActivationTrigger(1)})}),X=ve(),J=vt(),{isFocused:k,focusProps:p}=Ie({autoFocus:n}),{isHovered:j,hoverProps:G}=Pe({isDisabled:s}),g=$(()=>({open:e.comboboxState===0,disabled:s,invalid:e.invalid,hover:j,focus:k,autofocus:n}),[e,j,k,n,s,e.invalid]),z=ge({ref:F,id:b,role:"combobox",type:r,"aria-controls":(ee=e.optionsElement)==null?void 0:ee.id,"aria-expanded":e.comboboxState===0,"aria-activedescendant":e.activeOptionIndex===null?void 0:e.virtual?(Q=e.options.find(l=>!l.dataRef.current.disabled&&e.compare(l.dataRef.current.value,e.virtual.options[e.activeOptionIndex])))==null?void 0:Q.id:(Z=e.options[e.activeOptionIndex])==null?void 0:Z.id,"aria-labelledby":X,"aria-describedby":J,"aria-autocomplete":"list",defaultValue:(h=(W=t.defaultValue)!=null?W:e.defaultValue!==void 0?T==null?void 0:T(e.defaultValue):null)!=null?h:e.defaultValue,disabled:s||void 0,autoFocus:n,onCompositionStart:A,onCompositionEnd:O,onKeyDown:x,onChange:M,onFocus:B,onBlur:y},p,G);return le()({ourProps:z,theirProps:E,slot:g,defaultTag:Dt,name:"Combobox.Input"})}let Vt="button";function Lt(t,i){var M;let e=ie("Combobox.Button"),o=ae("Combobox.Button"),c=be(i,o.setButtonElement),f=de(),{id:b=`headlessui-combobox-button-${f}`,disabled:d=e.disabled||!1,autoFocus:T=!1,...s}=t,n=Me(e.inputElement),r=m(y=>{switch(y.key){case L.Space:case L.Enter:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&oe(()=>o.openCombobox()),n();return;case L.ArrowDown:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&(oe(()=>o.openCombobox()),e.value||o.goToOption(P.First)),n();return;case L.ArrowUp:y.preventDefault(),y.stopPropagation(),e.comboboxState===1&&(oe(()=>o.openCombobox()),e.value||o.goToOption(P.Last)),n();return;case L.Escape:if(e.comboboxState!==0)return;y.preventDefault(),e.optionsElement&&!e.optionsPropsRef.current.static&&y.stopPropagation(),oe(()=>o.closeCombobox()),n();return;default:return}}),E=m(y=>{y.preventDefault(),!Tt(y.currentTarget)&&(y.button===Ne.Left&&(e.comboboxState===0?o.closeCombobox():o.openCombobox()),n())}),S=ve([b]),{isFocusVisible:F,focusProps:a}=Ie({autoFocus:T}),{isHovered:U,hoverProps:N}=Pe({isDisabled:d}),{pressed:_,pressProps:I}=je({disabled:d}),A=$(()=>({open:e.comboboxState===0,active:_||e.comboboxState===0,disabled:d,invalid:e.invalid,value:e.value,hover:U,focus:F}),[e,U,F,_,d]),O=ge({ref:c,id:b,type:Ze(t,e.buttonElement),tabIndex:-1,"aria-haspopup":"listbox","aria-controls":(M=e.optionsElement)==null?void 0:M.id,"aria-expanded":e.comboboxState===0,"aria-labelledby":S,disabled:d||void 0,autoFocus:T,onMouseDown:E,onKeyDown:r},a,N,I);return le()({ourProps:O,theirProps:s,slot:A,defaultTag:Vt,name:"Combobox.Button"})}let wt="div",Bt=Be.RenderStrategy|Be.Static;function Nt(t,i){var Q,Z,W;let e=de(),{id:o=`headlessui-combobox-options-${e}`,hold:c=!1,anchor:f,portal:b=!1,modal:d=!0,transition:T=!1,...s}=t,n=ie("Combobox.Options"),r=ae("Combobox.Options"),E=st(f);E&&(b=!0);let[S,F]=at(E),[a,U]=Re(null),N=ut(),_=be(i,E?S:null,r.setOptionsElement,U),I=xe(n.buttonElement||n.inputElement),A=xe(n.optionsElement),O=ft(),[x,M]=nt(T,a,O!==null?(O&me.Open)===me.Open:n.comboboxState===0);Ye(x,n.inputElement,r.closeCombobox);let y=n.__demoMode?!1:d&&n.comboboxState===0;et(y,A);let B=n.__demoMode?!1:d&&n.comboboxState===0;Je(B,{allowed:fe(()=>[n.inputElement,n.buttonElement,n.optionsElement],[n.inputElement,n.buttonElement,n.optionsElement])}),Y(()=>{var h;n.optionsPropsRef.current.static=(h=t.static)!=null?h:!1},[n.optionsPropsRef,t.static]),Y(()=>{n.optionsPropsRef.current.hold=c},[n.optionsPropsRef,c]),it(n.comboboxState===0,{container:n.optionsElement,accept(h){return h.getAttribute("role")==="option"?NodeFilter.FILTER_REJECT:h.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(h){h.setAttribute("role","none")}});let X=ve([(Q=n.buttonElement)==null?void 0:Q.id]),J=$(()=>({open:n.comboboxState===0,option:void 0}),[n.comboboxState]),k=m(()=>{r.setActivationTrigger(0)}),p=m(h=>{h.preventDefault(),r.setActivationTrigger(0)}),j=ge(E?N():{},{"aria-labelledby":X,role:"listbox","aria-multiselectable":n.mode===1?!0:void 0,id:o,ref:_,style:{...s.style,...F,"--input-width":he(n.inputElement,!0).width,"--button-width":he(n.buttonElement,!0).width},onWheel:n.activationTrigger===0?void 0:k,onMouseDown:p,...ot(M)}),G=x&&n.comboboxState===1,g=Fe(G,(Z=n.virtual)==null?void 0:Z.options),z=Fe(G,n.value),pe=m(h=>n.compare(z,h));if(n.virtual){if(g===void 0)throw new Error("Missing `options` in virtual mode");Object.assign(s,{children:D.createElement(ue.Provider,{value:g!==n.virtual.options?{...n,virtual:{...n.virtual,options:g}}:n},D.createElement(Rt,{slot:J},s.children))})}let ee=le();return D.createElement(Ct,{enabled:b?t.static||x:!1,ownerDocument:I},D.createElement(ue.Provider,{value:n.mode===1?n:{...n,isSelected:pe}},ee({ourProps:j,theirProps:{...s,children:D.createElement(bt,{freeze:G},typeof s.children=="function"?(W=s.children)==null?void 0:W.call(s,J):s.children)},slot:J,defaultTag:wt,features:Bt,visible:x,name:"Combobox.Options"})))}let kt="div";function Ht(t,i){var k,p,j,G;let e=ie("Combobox.Option"),o=ae("Combobox.Option"),c=de(),{id:f=`headlessui-combobox-option-${c}`,value:b,disabled:d=(j=(p=(k=e.virtual)==null?void 0:k.disabled)==null?void 0:p.call(k,b))!=null?j:!1,order:T=null,...s}=t,n=Me(e.inputElement),r=e.virtual?e.activeOptionIndex===e.calculateIndex(b):e.activeOptionIndex===null?!1:((G=e.options[e.activeOptionIndex])==null?void 0:G.id)===f,E=e.isSelected(b),S=te(null),F=qe({disabled:d,value:b,domRef:S,order:T}),a=Te(ke),U=be(i,S,a?a.measureElement:null),N=m(()=>{o.setIsTyping(!1),o.onChange(b)});Y(()=>o.registerOption(f,F),[F,f]);let _=te(!(e.virtual||e.__demoMode));Y(()=>{if(!e.virtual&&!e.__demoMode)return we().requestAnimationFrame(()=>{_.current=!0})},[e.virtual,e.__demoMode]),Y(()=>{if(_.current&&e.comboboxState===0&&r&&e.activationTrigger!==0)return we().requestAnimationFrame(()=>{var g,z;(z=(g=S.current)==null?void 0:g.scrollIntoView)==null||z.call(g,{block:"nearest"})})},[S,r,e.comboboxState,e.activationTrigger,e.activeOptionIndex]);let I=m(g=>{g.preventDefault(),g.button===Ne.Left&&(d||(N(),gt()||requestAnimationFrame(()=>n()),e.mode===0&&o.closeCombobox()))}),A=m(()=>{if(d)return o.goToOption(P.Nothing);let g=e.calculateIndex(b);o.goToOption(P.Specific,g)}),O=tt(),x=m(g=>O.update(g)),M=m(g=>{if(!O.wasMoved(g)||d||r)return;let z=e.calculateIndex(b);o.goToOption(P.Specific,z,0)}),y=m(g=>{O.wasMoved(g)&&(d||r&&(e.optionsPropsRef.current.hold||o.goToOption(P.Nothing)))}),B=$(()=>({active:r,focus:r,selected:E,disabled:d}),[r,E,d]),X={id:f,ref:U,role:"option",tabIndex:d===!0?void 0:-1,"aria-disabled":d===!0?!0:void 0,"aria-selected":E,disabled:void 0,onMouseDown:I,onFocus:A,onPointerEnter:x,onMouseEnter:x,onPointerMove:M,onMouseMove:M,onPointerLeave:y,onMouseLeave:y};return le()({ourProps:X,theirProps:s,slot:B,defaultTag:kt,name:"Combobox.Option"})}let Ut=re(Mt),Gt=re(Lt),zt=re(Ft),Kt=yt,jt=re(Nt),Wt=re(Ht),Uo=Object.assign(Ut,{Input:zt,Button:Gt,Label:Kt,Options:jt,Option:Wt});export{Uo as Combobox,Gt as ComboboxButton,zt as ComboboxInput,Kt as ComboboxLabel,Wt as ComboboxOption,jt as ComboboxOptions};
